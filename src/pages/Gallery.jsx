import React, { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import PhoalbumBook from "../components/PhoalbumBook";
import PhoalbumGrid from "../components/PhoalbumGrid";

export default function Gallery() {
  const [isBookOpen, setIsBookOpen] = useState(false);
  const [isTurning, setIsTurning] = useState(false);
  const [targetIndex, setTargetIndex] = useState(null);

  const handleChapterSelect = (slug) => {
    const indexMap = {
      'introduce': 0, 'beijing': 1, 'wuxi': 2, 'hangzhou': 3, 'shanghai': 4,
      'wuhan': 5, 'shennongjia': 6, 'busan': 7, 'singapore': 8, 'zhejiang': 9,
      'japan': 10, 'gansu': 11, 'jingdezhen': 12, 'changshu': 13, 'xiamen': 14,
      'yunnan': 15, 'fengdu': 16, 'nanjing': 17, 'graduation': 18, 'end': 19
    };
    const idx = indexMap[slug];
    if (idx !== undefined) {
      setTargetIndex(idx);
      // 给一点延迟后重置，确保下次点击同一章节也能触发 useEffect
      setTimeout(() => setTargetIndex(null), 100);
    }
  };
  const [currentIndex, setCurrentIndex] = useState(0);

  // 章节文案映射 (按页码顺序匹配：page_1 -> 0, page_2 -> 1 ...)
  const storyContent = {
    0: { title: "PROLOGUE  PROLOGUE", text: "有想要做一本摄影集的想法很久了，但是总是陷于其他各种各样乱七八糟杂七杂八一二三四五六七的事情导致没有做成，本质上我是一个特别拖延的人，虽然我还是ENTJ，脑子里有好多好多好有意思的想法（自认为的）都还没有做，你看，不知不觉这就拖到了毕业，所以这回哪怕上刀山下火海也要做完！！！！！！！！\n\n做这本摄影集的初衷其实是我不知道从哪一刻起开始丧失了快乐，在生活中会莫名变得一本正经，而且似乎随着长大，对生活的感知力却在逐渐下降…，而摄影则是让我挖掘快乐、并感知生活的方式（当然还有画画），因此急切的想要我的所见所闻、我的快乐、我的小小的感悟能以实体的形式展展现，时刻提醒我Be Happy，Do Not Worry~。\n\n大学四年一晃而过，我真正开始习惯于记录也正是自我上本科之时，而我在前段时间回顾照片时，惊异发现已经对大一的自己产生了陌生感，但是不应该啊，印象中我只会对小时候的自己产生陌生感，可能是小时候的自己并没有过多的自我意识，但这四年可是我自己一步一步自己走过来的，那现在怎么会…这么说难道我要做一本陌生人的“摄影集”？！“我”是谁？“我”又变成了谁？\n\n于是在这本摄影集制作的过程中我开始干了一件和这四年的我所做的一样的事情——“找自己”" },
    1: { title: "BEIJINGBEIJING", text: "在北京实习的第一个周末出来闲逛，忙完了一周想着这是一个新的开始所以想去庙宇里祈福烧香，于是来到了最灵最灵的雍和宫，求的啥就不说了不然不灵了哈哈哈哈。\n\n印象中的北京还是它2008年的样子，它朦胧但是又清晰，儿时记忆中的北京城浓缩成颜色便是红黄蓝，即三原色，作为美术生对颜色当然最敏感啦，每当看到鲜艳的色彩就会让我想起北京，所以北京于我似乎一直存在着某种羁绊，这不，儿时的记忆牵引着我重新来到了北京。" },
    2: { title: "MAANSHANWUXICHANGZHOU", text: "毕业前最后一周，我和朋友们决定完成一个大学四年想做却没做的事儿—自驾游，平日很难有这样的机会一同出游，刚好呢，毕设做完了、学院毕业典礼、毕业照这些环节也都结束了，每个人都在想着毕业后大家见面的机会可能就不多了，因此以毕业为契机，我们一行6个人在皖江一带自驾游了三天，前往了马鞍山、无锡、常州三地，其实在各个目的地由于江南梅雨季的原因，游玩起来身上黏糊糊的且阴雨连绵，体验并没有特别的好，但是，最好的旅程、最好的风景永远是在路上，自驾全程将近400km，我们就这样唱歌聊天了一路，沿路见证了挂满积雨云的蓝天、一个又一个湖泊的波光粼粼、暴雨后的夕阳，总的来说呢，这段旅程给大学四年画下了一个圆满的句号，也将是我这辈子难忘的回忆…" },
    3: { title: "HANGZHOUHANGZHOU", text: "杭州，其实在24年那次研学旅行时就和朋友们一起来过，但是那时正值暑假，人来人往、熙熙攘攘，这次趁着来看Ed Sheeran演唱会的机会，和之前冬令营的好好朋友们一同又来到了杭州，在初春的西湖湖堤走走停停，直至太阳落下去，又去到了灵隐寺，烧香祈福。当然这次来玩主线还是黄老板演唱会啦，现场演唱堪比录音棚，能够见到自己小时候耳机里的歌星，也算是另一种形式的圆梦了。在杭州的最后一天，我还淘到了黄老板的唱片专辑以及我最爱的陶喆黄专，也得感谢我的大四生活，在没有繁重课业的大四下，我终于有时间做做自己想做的事儿，感受生活圈以外的节奏…" },
    4: { title: "SHANGHAISHANGHAI", text: "上海于我来说是比较特殊的地方了，四年里来来回回去过好多次上海，这里可以说是我的梦想实现地（高中），在高中的时候最希望去的城市就是城市，可惜当年因为一堆原因就没去成，后来呢，一次偶然的机会，朋友喊上我说上海有办一个画展“从波提切利到梵高”，当时我们立刻买上了第二天出发的票，也就是这次出行，重新激发起了我想来到上海的心愿，同样也激发起了我对外探索的决心。\n\n又后来呢，我决心保研来上海，上海又成为了我圆梦的地方，在这里度过不少日夜去完成我的作品集，中间历经了不少挫折，好在最后此阶段的心愿达成啦！以后还要在上海待很久很久，那么先看看这四年围绕上海发生的故事…" },
    5: { title: "WUHANWUHAN", text: "说到我的家乡，每次回来似乎都加上了令人窒息的有效期，高铁到站的那一刻就开始默默在心里对假期进行倒计时，但是这样让我更加珍惜在家与家人相处的时间，一年又一年，似乎是对这里的一切过分熟悉，因此每次回家都会发现许多变化，弟弟妹妹长大了，家人似乎烙上了更深时间的印记…\n\n当初的我是如何下定决心离开生活了18年的家乡的呢，也许是刚高考完总有股使不完的冲劲，又也许是急切希望跳出舒适圈，看看自己能有多大的能耐，一跳跳到了南京，现今又一跳跳到了上海，此时的我不知我的决定在未来来看是否正确，以目前来看，我收获了友谊、见证了不同地方的朝霞日落、四年里收获了不错的成绩，我已经心满意足了。说到我的大学期间其实有过很多无助茫然的时刻，但又正如余华在《十八岁出门远行》这本书中说过“尽管这样我还是一次一次地往高处奔，次次都是没命的奔，眼下我又往高处奔去”，未来的我不妨更大胆些，继续多闯闯，祝自己未来可期！" },
    6: { title: "SHENNONGJIASHENNONGJIA", text: "新年后的寒假总感觉在家待着不得劲，和好兄弟出去吃饭的时候突然刷到了好多滑雪的视频，我们便一拍即合，走起，这个冬天去滑雪，而离武汉最近的滑雪胜地就是神农架了，刚好，早有耳闻神农架风景优美，还有野人出没（），我们便定下了目的地为神农架。\n\n来了以后才发现原来湖北还是有这么高的山峰的，而又因为多高山，植被也呈现出明显的垂直分布，所以风景也超级优美，还见到了久违的大雪！就说湖北不完全属于南方吧，反正呢，在这里见到了很多从未见过的风景，和朋友出游又有更多的欢乐（在北京经常一个人出游其实有些过于孤单了），最重要的是我在这里迅速学会了滑雪（还得是我天赋异禀），明年还要继续滑雪，玩完后总感觉世界这么大，还有这么多我未曾体验过的新鲜事，那么我要趁年轻多多探索世界。" },
    7: { title: "BUSANBUSAN", text: "这段行程是插在北京实习期间的，说起这段行程，还得是和韩国同事聊天得知釜山算是旅游胜地，超级好玩，所以一直有在计划这段行程，本来想着找个周末直接出发两天就回，那为什么出行日期在圣诞节呢，因为在外企嘛，圣诞节是有一天假期的，在放假前一周我就问mentor能不能多请几天假期，趁这个机会去釜山玩一圈儿，mentor超级爽快的答应了，于是叫上了很早就摇好了的朋友，计划在韩国过人生中第一个真正意义的圣诞节…\n\n釜山之行真的很不错，反季节看海加上超级浓厚的圣诞氛围都带来了全新的体验，虽然…这段行程只有短短的四天，但是四天暴走釜山，留下了难得的人生体验，话不多说，往后翻页，开启回忆之旅……" },
    8: { title: "SINGAPORESINGAPORE", text: "来到新加坡其实也是出乎意料的，这还得说会到距离这段行程前的四个月，我们几个在设计冬令营认识的伙伴们一起做了一个产品，在我们抱着试试的心态下投递了红点奖，没想到竟然拿下了，官方邀请我们去现场参加颁奖典礼，于是呢，以此为契机，我们开始规划起了新加坡的行程…\n\n几个人在新加坡日常Citywalk、逛吃逛吃、博物馆、美术馆，走起的都是文艺路线，嗷对，还一起去游玩了环球影城。在新加坡的这段经历于我来说也非常的戏剧化，当时已经是10月了嘛，正常情况下，我的保研进程应该已经结束了，我已经准备美美出去玩完再去北京实习美美GAP一年，结果没想到同济突然增开了二轮面试，我也是抱着试试的心态投递了，然后呢，在新加坡的时候我收到了进面试的通知，我当时和朋友们说如果面试时间是在我在新加坡期间我就直接拒绝了，出乎意料的是面试时间刚好是在我回国的第二天，这不，回国的飞机上我就一直在准备快题面试，下飞机后已经是面试当天的凌晨，就这样，睡了3个小时的我面试了一整天又匆匆赶上了去北京实习的飞机，讲远啦，总之，新加坡给我的体验也非常的奇妙，翻开这页，开启新加坡之旅…" },
    9: { title: "ZHEJIANGZHEJIANG", text: "此次行程是本科期间研学行程的第二段，一路前往了湖州、安吉、临安、余杭、杭州，和一群朋友一起出游，似乎能找到一丝童年时对春游的向往，这次行程我们去过了不少游乐场、去了动物园、挑战了悬崖边荡秋千，也体验了不少自然风光，对了，关于这页的照片，让我记得那会儿黑神话刚刚发行，因此拍的不少照片构图或者色调、取景都有黑神话的影子。当时出游的心境是怎样的呢，当时正值保研季，7月大获全败，因此一整个8月都在准备9月的预推免，出游时的夜晚还在修改我的作品集，因此出行还是略有疲惫的。总之呢，作为大学期间最后一次集体出游，希望我的相机能够记录下我们青春时充满活力的样貌、能够记录下我的回忆……" },
    10: { title: "JAPANJAPAN", text: "日本前前后后加上毕业后的暑假去了有三次了，这里真的怎么都玩不腻，也许是和一起游玩的朋友、家人又或者每回来日本抽签都是吉签有关，每次在这里都能留下特别好的体验，与国内不大相同的风景、人文，真的每次来都有新的体会感悟。\n\n说到来过几次日本的经历，第一次是和学校的朋友们去日本爱知工业大学交流，加藤老师和铃木老师带我们玩了日本的三个城市：名古屋、京都、大阪，老师和那边同学的热情好客给我留下了对日本的初印象，我还交了好多日本盆友，对了，出行时小伙伴们本是不太熟悉的，但是就这么几天大家仿佛相处了好几年的，反正就是玩的特别开心…第二次是和美术集训时玩的超级好的朋友以及一位虽是新相识却迅速熟络起来的朋友一起去玩儿，大家一起去了大阪、京都、东京，这段经历在这就不细说了，都是我此生难得的一段体验…" },
    11: { title: "GANSUGANSU", text: "来甘肃玩也是临时起意的，本来正处于保研的关键期，刚投完作品集和简历，本来还在担心保研入营结果这些呢，结果就收到了被拒的消息，悲痛欲绝的我立马和我妈说：你之前说的甘肃行走起吧，好好玩这个暑假，玩的过程中等待等待同济的消息（虽然在察尔汗盐湖还是收到了被拒绝的消息）。第二天我们就立刻出发了，现在来看去旅行的决定非常的正确，避免了许多没必要的担忧，青甘大环线超绝景色会让人忘却一切烦恼。\n\n说到这次游玩的风景，我们感受到了以前从未见过的地貌，比如丹霞、雅丹、沙漠、盐湖…以及亲切又新颖的文化，这还是我第一次全程体验自然风光的旅程，自然在我印象中挥之不去，总之，这次旅行我当上了大西北探险家，探险之章从这里开始…" },
    12: { title: "JINGDEZHENWUYUAN", text: "夏日的景德镇阴雨阵阵，但是雨中的景德镇立刻让我想起周杰伦的青花瓷，“天青色等烟雨，而我在等你”，在音乐声里坐在青石板上，看着远处的徽派建筑，手上拿着笔在本子上走走停停，这就是在景德镇还有婺源的我的日常。\n\n说到这次的江西之旅，其实是我们大二的实践课，来到了这里进行采风调研（其实就相当于跟团旅游），也算是设计六虎将的第一次集体出游，具体的细节到现在记的已经不太清楚了，印象中只记得辣、瓷器、山川、白墙黛瓦、河流这些关键词，嗷，还记得在whn的嘴巴输出下，以五折的价格拿下了到现在都一直在盘的一个志野烧（柴烧的）杯子。景德镇于我来说当然算得上大学里难忘的记忆，也就是在这里，让我重拾了对写生的兴趣，拿起了许久未曾动过的画笔，画下了许多那时的心境……" },
    13: { title: "CHANGSHUCHANGSHU", text: "在老师的邀请下，我和fyh一同来到了常熟参加了海峡两岸的设计交流活动，在常熟我们可能并没有游玩太多风景，和大多江南小镇给我的印象相似，这里的生活节奏慢慢的、干净的街道、小桥流水、粉墙黛瓦，来到这座城，仿佛走进了吴冠中的画。\n\n在这里我们也结识了许多台湾的朋友，了解了很多台湾的民俗、好玩的风景还有美食，有机会一定要去台湾看看。摄影集的这一部分也正如我前面所述，风景照片就没得那么多啦，主要的还是人人人，热闹的大家…" },
    14: { title: "XIAMENXIAMEN", text: "夏天那么热，当然得去看看海啦，几个集训时关系特好的朋友们一起约定好来厦门去看看海，其实选择去到厦门是因为有个朋友刚好在厦门上学，于是，说走就走，我们来到了厦门，第一次住民宿、第一次大海里游泳游的老远、第一次通宵一宿为了看海上日出，都是这次厦门游难忘的点。\n\n心情烦闷的时候去看看海吧，很幸运我们来的时候游客不算特别多，又或者海的辽阔让我忽略了眼前的一些嘈杂，很可惜那会儿因为我接下来要去云南支教，我们一群人没能多待几天，好在我留下了不少记忆碎片，拼凑起来能够重忆起那个难忘的暑假…" },
    15: { title: "YUNNANYUNNAN", text: "来云南有两次了，其实小时候也有来过，但是记忆当然不深啦，这里咱们主要讲述这四年里去过的地方，第一次是和爸妈还有妹妹一块儿来的，第二次是因为支教以及社会实践考察来的，两次来云南的目的地也大有不同，第一次来去了昆明、丽江、大理，第二次去了昆明、楚雄市南华县，每次来云南感受也特别舒服，心会进入一种很静的状态，或许是四季如春的气候带来的又或许是这里的人热情好客带来的，在这里，是人与自然和谐相处最好的诠释，自然永远巍然树立在那里，人悠闲自得，桃花源也不过如此。第一次前来可能是对云南的初印象，对云南的人们并没有特别多的了解，第二次则是深入与云南的人们交流，深入接触彝族的文化，也就是云南让我更加的憧憬自然风光，未来的旅行也会更多的看看祖国至世界的大好河山…" },
    16: { title: "FENGDUFENGDU", text: "人生中的第一次支教体验就是在重庆市丰都县，对于重庆我一直有种亲切感，可能是我外公有好多重庆的战友，也有可能是我超级爱重庆的菜肴，因此来到丰都，更能快速感受到这里的热情好客。丰都待的日子也并没有很久，主要路线还是在栗子乡了，对我来说，乡村似乎有些陌生，印象中的乡村宁静而美好，来到这里却又多了几分感受，栗子乡正如它的名字一样，有种淡淡的香甜、美好与诗意，“这里清晨的风很温柔，很清凉，人很淳朴，热情；栗子乡的味道是李子的酸甜，是小面油辣子的香味”这是在迎着朝霞的远行回家的路上写下的话。在栗子乡里支教最深刻的体验就是感受到了一种不同于城市的宁静，不论是自然环境还是人们的心境，在这里你一定会被小朋友们各种真挚的情感触动。第一次体验当老师，也从小孩子们的身上看见了曾经的自己…" },
    17: { title: "NANJINGNANJING", text: "这里就是我待了四年的地方—南京，关于这里有太多想说的了…在这里敲字还有些语塞，这里发生了太多的故事，一路走来跌跌撞撞，在这里有实现也有遗憾。其实本来我对南京这座城并没有过多的感情，或许是和武汉过于相似的气候、也或许是大学四年大部分时间被课业占据，又或许是疫情封校那一年多没有让你对南京拥有足够的了解，那时候所有发生在南京的故事大部分仅限在湖区这边，最厚重最能代表南京的地方却并没有那么的熟悉，那时对南京的了解还是跟着一群人在摄影课换来的出校机会下换来的，对了，这群人在后面的章节里还会出现，剩余的大部分对南京的了解也和这群人有关。\n\n那真正的开始认识起来是什么时候呢…，兴许是大三准备保研那会儿还有大四下学期吧，很神奇，大三算是我最这四年最忙碌的时候，那怎么有时间去了解的呢？这就不得不提到另一个同样来自武汉比我小一届的好盆友了，忙里偷闲和他在南京城骑来骑去逛吃逛吃了好多地方，后面我也自己挑战过从湖区骑到市区，全程呢大概400km，再到后面就是保研失利（最后上岸了）后的一个学期初始和一个现在到上海做作品集的朋友绕着南京城骑行了70km，基本骑了一圈，也去到了许多来南京后从未涉足的地方。骑车真的能让我慢下来去观察去体验这座城…\n\n其实到现在我都没有很熟悉南京座城，但是在临近毕业的这段日子我却开始爱上南京了，在相对较空闲的大四下时光里终于有时间看看南京了，但是仍然遗憾欣赏不完它的美景，没有足够时间了解这里的人，没有吃遍这里的美食…。现在也只是靠着零碎的片段支撑起了我记忆中的南京，好在我有相机，好在我热爱记录，才能让这些零碎的记忆呈现出来，成为一个可观察可触摸的珍贵的宝藏，它不是模糊的，它是清晰的，它代表着我的成长、代表着20岁出头的我、那个青涩、18岁就出远门的我…" },
    18: { title: "GRADUATIONGRADUATION", text: "毕业季正值炎热的夏日，那就暂时先甩开临近毕业的忙碌和伤感，躺在草坪上、在和童年一般无忧无虑、快乐的梦里躲躲烈日吧…其实这天正是为了拍一组比较正式比较值得留念的毕业照而来的，而且在这前一天的我查过天气预报，自这天之后，南京便正式进入梅雨季，也就是说在毕业前很可能再没有如此热烈阳光了，趁着这个机会，我决定叫上Hin和肇伟一起在四牌楼拍一组毕业照！" },
    19: { title: "ENDEND", text: "故事真的结束了吗？……那当然没有，故事永远还在继续。\n\n这本摄影集更多代表的是大学四年记忆的一种封存又或者是我活着、存在着的一种证明，我始终不愿空白的来这世上一遭，我总希望我能留下一些什么，这本摄影集我会留存视频版、电子版、实体版，无论如何我会用我的方式在这个世界上留下我的清晰的痕迹，多年以后我可能会变得忘记自己的初心、忘记自己活着的意义究竟为何，又或许年老之时可能会怀念年轻之时那个鲜活的自己，希望这本摄影集能不时的提醒我我的人生有过这么精彩的四年，希望自己能够永远保持开心，保持对这世间所存在的一切的好奇。\n\n恭喜你！Jerry，这四年里你找到了自己，祝未来的你继续探索到自己人生的意义，永远保持一种“澄澈”感，在“找自己”的路上永远能够找到自己，最终Free（此处应该点歌哈哈哈哈哈），也永远记住对生活要持有一种理想主义，OK！那么就写这么多。\n\n——总之，这是一本做给未来的摄影集，也是一本时间胶囊…" }
  };

  const currentStory = storyContent[currentIndex] || storyContent[0];

  const deckItems = [
    { src: "/photography/page_1_01.png", alt: "1-1" },
    { src: "/photography/page_1_02.png", alt: "1-2" },
    { src: "/photography/page_2_01.png", alt: "2-1" },
    { src: "/photography/page_2_02.png", alt: "2-2" },
    { src: "/photography/page_3_01.png", alt: "3-1" },
    { src: "/photography/page_3_02.png", alt: "3-2" },
    { src: "/photography/page_4_01.png", alt: "4-1" },
    { src: "/photography/page_4_02.png", alt: "4-2" },
    { src: "/photography/page_5_01.png", alt: "5-1" },
    { src: "/photography/page_5_02.png", alt: "5-2" },
    { src: "/photography/page_6_01.png", alt: "6-1" },
    { src: "/photography/page_6_02.png", alt: "6-2" },
    { src: "/photography/page_7_01.png", alt: "7-1" },
    { src: "/photography/page_7_02.png", alt: "7-2" },
    { src: "/photography/page_8_01.png", alt: "8-1" },
    { src: "/photography/page_8_02.png", alt: "8-2" },
    { src: "/photography/page_9_01.png", alt: "9-1" },
    { src: "/photography/page_9_02.png", alt: "9-2" },
    { src: "/photography/page_10_01.png", alt: "10-1" },
    { src: "/photography/page_10_02.png", alt: "10-2" },
    { src: "/photography/page_11_01.png", alt: "11-1" },
    { src: "/photography/page_11_02.png", alt: "11-2" },
    { src: "/photography/page_12_01.png", alt: "12-1" },
    { src: "/photography/page_12_02.png", alt: "12-2" },
    { src: "/photography/page_13_01.png", alt: "13-1" },
    { src: "/photography/page_13_02.png", alt: "13-2" },
    { src: "/photography/page_14_01.png", alt: "14-1" },
    { src: "/photography/page_14_02.png", alt: "14-2" },
    { src: "/photography/page_15_01.png", alt: "15-1" },
    { src: "/photography/page_15_02.png", alt: "15-2" },
    { src: "/photography/page_16_01.png", alt: "16-1" },
    { src: "/photography/page_16_02.png", alt: "16-2" },
    { src: "/photography/page_17_01.png", alt: "17-1" },
    { src: "/photography/page_17_02.png", alt: "17-2" },
    { src: "/photography/page_18_01.png", alt: "18-1" },
    { src: "/photography/page_18_02.png", alt: "18-2" },
    { src: "/photography/page_19_01.png", alt: "19-1" },
    { src: "/photography/page_19_02.png", alt: "19-2" },
    { src: "/photography/page_20_01.png", alt: "20-1" },
    { src: "/photography/page_20_02.png", alt: "20-2" },
  ];

  return (
    <main className="min-h-screen pt-32 flex flex-col items-center" style={{ background: '#F2F2F2' }}>
      {/* 叠层容器：grid 在下，book 在上，视觉重合 */}
      <div className="relative w-full">

        {/* 底层：导航网格（书打开后自动隐藏） */}
        {/* marginTop ← 调整网格整体垂直位置 */}
        <div className="w-full" style={{ zIndex: 1, marginTop: '50px' }}>
          <PhoalbumGrid isOpen={isBookOpen} onSelect={handleChapterSelect} />
        </div>

        {/* 顶层：书（封面+箭头），绝对定位悬浮在网格上 */}
        <div
          className="absolute inset-0 flex justify-center pointer-events-none"
          style={{ zIndex: 10 }}
        >
          <PhoalbumBook
            items={deckItems}
            isInitialClosed={true}
            showControls={true}
            hintX={35}
            hintY="-16%"
            hintScale={0.55}
            coverGroupScale={1.1}
            coverGroupShadow="0 10px 30px rgba(0, 0, 0, 0.2)"
            overlayScale={1.009}
            onStateChange={setIsBookOpen}
            onTurnChange={setIsTurning}
            onIndexChange={setCurrentIndex}
            targetIndex={targetIndex}
          />
        </div>

      </div>

      {/* 底部详情面板：书本打开且没有在翻页时显示 */}
      <AnimatePresence>
        {isBookOpen && !isTurning && (
          <motion.div
            className="gallery-overlay"
            variants={{
              initial: { y: "100%", opacity: 0 },
              animate: {
                y: 0,
                opacity: 1,
                transition: { delay: 1, duration: 0.8, ease: [0.33, 1, 0.68, 1] }
              },
              exit: {
                opacity: 0,
                transition: { duration: 0.3 } // 👈 立即淡出，不等待
              }
            }}
            initial="initial"
            animate="animate"
            exit="exit"
          >
            {/* 左侧标题区 */}
            <div className="overlay-left">
              <div
                className="pixel-title"
                style={{
                  whiteSpace: 'nowrap',
                  // 优化后的字号缩放：基准设为 44vw 以预留边距，使字号变动更灵活且不贴边
                  fontSize: `min(calc(65vw / ${currentStory.title.length}), 160px)`,
                  lineHeight: '1'
                }}
              >
                {currentStory.title}
              </div>
            </div>

            {/* 右侧内容区 */}
            <div className="overlay-right">
              <div className="content-text">
                {currentStory.text.split('\n\n').map((para, pIdx) => (
                  <p key={pIdx}>
                    {pIdx === 0 ? (
                      <>
                        <span className="drop-cap">{para.charAt(0)}</span>
                        {para.slice(1)}
                      </>
                    ) : para}
                  </p>
                ))}
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </main>
  );
}